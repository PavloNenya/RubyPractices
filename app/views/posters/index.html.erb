<div class="block_posters">
  <div class="posters__search-form">
    <%= form_tag(posters_path, method: "get") do %>
      <%= text_field_tag :search, params[:search], placeholder: "Search for posters by service..." %>
      <%= submit_tag "Search" %>
    <% end %>
  </div>

  <div class="posters__list" id="posters">
    <% if @posters.any? %>
      <div class="sorting-options">
        <% if params[:sort] != 'average_rating' %>
          <%= link_to 'Sort by Average Rating', posters_path(sort: 'average_rating', search: params[:search]) %>
        <% else %>
          <%= link_to 'Sort by Default', posters_path(search: params[:search]) %>
        <% end %>
        <% if params[:sort] != 'num_reviews' %>
          <%= link_to 'Sort by Number of Reviews', posters_path(sort: 'num_reviews', search: params[:search]) %>
        <% else %>
          <%= link_to 'Sort by Default', posters_path(search: params[:search]) %>
        <% end %>
        <% if params[:sort] != 'num_dates' %>
          <%= link_to 'Sort by Number of Dates', posters_path(sort: 'num_dates', search: params[:search]) %>
        <% else %>
          <%= link_to 'Sort by Default', posters_path(search: params[:search]) %>
        <% end %>
      </div>
    <% end %>
    <% @posters.each do |poster| %>
      <div class="poster">
        <%= render poster %>
        <% if poster.reviews.any? %>
          <% average_rating = poster.reviews.average(:rating) %>
          <p class="average-rating" style="color: green">Average Rating: <%= '%.2f' % average_rating %></p>
        <% else %>
          <p class="average-rating" style="color: green">No reviews yet</p>
        <% end %>
        <p class="num-reviews">Number of Reviews: <%= poster.reviews.count %></p>
        <p class="num-dates">Number of Dates: <%= poster.payments.distinct.count(:date) %></p>
        <p class="poster__link">
          <%= link_to "Show this poster", poster %>
        </p>
      </div>
    <% end %>
  </div>
</div>
